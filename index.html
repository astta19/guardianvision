<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Fiscal365</title>
  <meta name="theme-color" content="#1a1a1a">
  

  <!-- √çcones e UI -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Libs de documentos -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.min.js"></script>

  <!-- Estilos -->
  <link rel="stylesheet" href="assets/css/app.css?v=6">
</head>
<body>
<!-- TELA DE LOADING -->
  <div id="loadingScreen" style="position:fixed;inset:0;background:#fff;z-index:9999;display:flex;align-items:center;justify-content:center;transition:opacity 0.3s ease">
    <div style="width:36px;height:36px;border:3px solid #e2e8f0;border-top-color:#000;border-radius:50%;animation:spin 0.75s linear infinite"></div>
  </div>

  <!-- MODAL DE CONFIRMA√á√ÉO -->
  <div id="confirmModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:9000;align-items:center;justify-content:center;padding:20px">
    <div style="background:var(--card);border-radius:16px;padding:24px;width:100%;max-width:360px;box-shadow:0 8px 32px rgba(0,0,0,0.15)">
      <p id="confirmModalText" style="font-size:15px;font-weight:500;color:var(--text);margin-bottom:20px;line-height:1.5"></p>
      <div style="display:flex;gap:10px;justify-content:flex-end">
        <button id="confirmModalCancel" style="padding:10px 20px;border-radius:8px;border:1px solid var(--border);background:var(--bg);color:var(--text);font-size:14px;cursor:pointer;font-weight:500">Cancelar</button>
        <button id="confirmModalOk" style="padding:10px 20px;border-radius:8px;border:none;background:var(--accent);color:#fff;font-size:14px;cursor:pointer;font-weight:500">Confirmar</button>
      </div>
    </div>
  </div>

  <!-- TELA DE AUTENTICA√á√ÉO -->
    <div id="authScreen" class="hidden">
    <div class="auth-box">
      <div class="auth-logo">
        <i data-lucide="shield-check" style="width:36px;height:36px;color:var(--accent)"></i>
        <h2>Chat Fiscal Pro</h2>
        <p id="authSubtitle">Acesso exclusivo para colaboradores</p>
      </div>

      <!-- LOGIN -->
      <div id="loginForm">
        <div class="auth-field">
          <label>E-mail</label>
          <input type="email" id="loginEmail" placeholder="seu@email.com" autocomplete="email">
        </div>
        <div class="auth-field">
          <label>Senha</label>
          <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"
            onkeypress="if(event.key==='Enter') doLogin()">
        </div>
        <button class="auth-btn" onclick="doLogin()" id="loginBtn">Entrar</button>

        <div class="auth-divider"><span>ou</span></div>

        <button class="google-btn" onclick="doGoogleLogin()" type="button">
          <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.18 1.48-4.96 2.31-8.16 2.31-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
          Continuar com Google
        </button>
        <button class="auth-link-btn" onclick="showAuthState('reset')">Esqueci minha senha</button>
        <div class="auth-msg" id="loginMsg"></div>
      </div>

      <!-- DEFINIR SENHA (convite / primeiro acesso) -->
      <div id="setPasswordForm" style="display:none">
        <div class="auth-field">
          <label>Nova senha</label>
          <input type="password" id="newPassword" placeholder="M√≠n. 8 caracteres" autocomplete="new-password" oninput="checkPasswordStrength(this.value)">
          <div class="pwd-strength"><div class="pwd-strength-bar" id="pwdBar"></div></div>
          <div class="pwd-hint" id="pwdHint"></div>
        </div>
        <div class="auth-field">
          <label>Confirmar senha</label>
          <input type="password" id="confirmPassword" placeholder="Repita a senha" autocomplete="new-password"
            onkeypress="if(event.key==='Enter') doSetPassword()">
        </div>
        <button class="auth-btn" onclick="doSetPassword()" id="setPasswordBtn">Definir senha e entrar</button>
        <div class="auth-msg" id="setPasswordMsg"></div>
      </div>

      <!-- RECUPERAR SENHA -->
      <div id="resetForm" style="display:none">
        <p style="font-size:13px;color:var(--text-light);margin-bottom:16px;line-height:1.6">
          Digite seu e-mail e enviaremos um link para redefinir sua senha.
        </p>
        <div class="auth-field">
          <label>E-mail</label>
          <input type="email" id="resetEmail" placeholder="seu@email.com" autocomplete="email"
            onkeypress="if(event.key==='Enter') doReset()">
        </div>
        <button class="auth-btn" onclick="doReset()" id="resetBtn">Enviar link</button>
        <button class="auth-link-btn" onclick="showAuthState('login')">‚Üê Voltar ao login</button>
        <div class="auth-msg" id="resetMsg"></div>
      </div>

      <!-- CONFIRMA√á√ÉO ENVIADA -->
      <div id="confirmSentForm" style="display:none;text-align:center;padding:8px 0">
        <div style="margin-bottom:16px"><i data-lucide="mail" style="width:48px;height:48px;color:var(--accent)"></i></div>
        <p style="font-weight:600;margin-bottom:8px" id="confirmSentTitle">Link enviado!</p>
        <p style="font-size:13px;color:var(--text-light);line-height:1.6" id="confirmSentText">
          Verifique sua caixa de entrada e clique no link para continuar.
        </p>
        <button class="auth-link-btn" style="margin-top:16px" onclick="showAuthState('login')">‚Üê Voltar ao login</button>
      </div>
    </div>
  </div>

  <!-- MODAL DE CLIENTES -->
  <div id="clientModal" class="hidden">
    <div class="client-modal-box">
      <div class="client-modal-head">
        <h3><i data-lucide="building-2" style="width:18px;height:18px;vertical-align:middle;margin-right:6px"></i>Selecionar Empresa</h3>
        <button class="btn-close" onclick="closeClientModal()"><i data-lucide="x"></i></button>
      </div>
      <div id="clientList" class="client-list">
        <p style="text-align:center;color:var(--text-light);font-size:13px;padding:12px">Carregando...</p>
      </div>
      <button class="btn-add-client admin-only" onclick="toggleNewClientForm()" style="display:none">
        <i data-lucide="plus"></i> Cadastrar nova empresa
      </button>
      <div id="newClientForm">
        <div class="form-sep"></div>
        <div class="form-field">
          <label>Raz√£o Social *</label>
          <input type="text" id="fRazao" placeholder="Empresa Ltda">
        </div>
        <div class="form-field">
          <label>CNPJ *</label>
          <input type="text" id="fCnpj" placeholder="00.000.000/0000-00" oninput="maskCnpj(this)" onblur="autoPreencherCNPJ(this.value)">
        </div>
        <div class="form-field">
          <label>Nome Fantasia</label>
          <input type="text" id="fFantasia" placeholder="Opcional">
        </div>
        <div class="form-field">
          <label>Regime Tribut√°rio</label>
          <select id="fRegime">
            <option value="">Selecione...</option>
            <option value="Simples Nacional">Simples Nacional</option>
            <option value="Lucro Presumido">Lucro Presumido</option>
            <option value="Lucro Real">Lucro Real</option>
            <option value="MEI">MEI</option>
          </select>
        </div>
        <div class="form-field">
          <label>Inscri√ß√£o Estadual</label>
          <input type="text" id="fIE" placeholder="Opcional">
        </div>
        <div class="form-field admin-only" id="fContadoresField" style="display:none">
          <label>Atribuir contadores</label>
          <div id="fContadoresList" style="display:flex;flex-direction:column;gap:6px;max-height:120px;overflow-y:auto;padding:4px 0">
            <p style="font-size:12px;color:var(--text-light)">Carregando usu√°rios...</p>
          </div>
        </div>
        <div class="form-actions">
          <button class="btn-cancel" onclick="toggleNewClientForm()">Cancelar</button>
          <button class="btn-save" onclick="saveNewClient()">Salvar Empresa</button>
        </div>
        <div id="clientFormMsg" class="auth-msg"></div>
      </div>
    </div>
  </div>

  <!-- MODAL SPED EFD-ICMS/IPI -->
  <div id="spedModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:9000;align-items:center;justify-content:center;padding:16px" onclick="if(event.target===this)closeSped()">
    <div class="sped-modal-box">
      <div class="sped-header">
        <div>
          <h2><i data-lucide="file-code-2" style="width:18px;height:18px;vertical-align:-3px"></i> SPED EFD-ICMS/IPI</h2>
          <div class="sped-periodo-atual" id="spedPeriodoAtual">Selecione ou crie um per√≠odo</div>
        </div>
        <button onclick="closeSped()" style="background:none;border:none;cursor:pointer;font-size:20px;color:var(--text-light)">‚úï</button>
      </div>

      <!-- Tabs -->
      <div class="sped-tabs">
        <button class="sped-tab-btn active" onclick="switchSpedTab('periodos')">üìÖ Per√≠odos</button>
        <button class="sped-tab-btn" onclick="switchSpedTab('documentos')">üìÑ Documentos (C100)</button>
        <button class="sped-tab-btn" onclick="switchSpedTab('participantes')">üè¢ Participantes (0150)</button>
        <button class="sped-tab-btn" onclick="switchSpedTab('produtos')">üì¶ Produtos (0200)</button>
        <button class="sped-tab-btn" onclick="switchSpedTab('apuracao')">üßÆ Apura√ß√£o ICMS (E110)</button>
      </div>

      <!-- PAINEL: Per√≠odos -->
      <div class="sped-panel" id="spedPanel_periodos">
        <div class="sped-section-title">Novo Per√≠odo</div>
        <div class="sped-form-row">
          <div class="field">
            <label>M√™s *</label>
            <select id="spedMes">
              <option value="01">Janeiro</option><option value="02">Fevereiro</option>
              <option value="03">Mar√ßo</option><option value="04">Abril</option>
              <option value="05">Maio</option><option value="06">Junho</option>
              <option value="07">Julho</option><option value="08">Agosto</option>
              <option value="09">Setembro</option><option value="10">Outubro</option>
              <option value="11">Novembro</option><option value="12">Dezembro</option>
            </select>
          </div>
          <div class="field">
            <label>Ano *</label>
            <input type="number" id="spedAno" value="2025" min="2010" max="2030">
          </div>
          <div class="field">
            <label>UF *</label>
            <select id="spedUF">
              <option>AC</option><option>AL</option><option>AP</option><option>AM</option>
              <option>BA</option><option>CE</option><option>DF</option><option>ES</option>
              <option>GO</option><option>MA</option><option>MT</option><option>MS</option>
              <option>MG</option><option>PA</option><option>PB</option><option>PR</option>
              <option>PE</option><option>PI</option><option>RJ</option><option>RN</option>
              <option>RS</option><option>RO</option><option>RR</option><option>SC</option>
              <option selected>SP</option><option>SE</option><option>TO</option>
            </select>
          </div>
          <div class="field">
            <label>Inscri√ß√£o Estadual</label>
            <input type="text" id="spedIE" placeholder="000.000.000.000">
          </div>
          <div class="field">
            <label>Perfil</label>
            <select id="spedPerfil">
              <option value="A">A ‚Äî Completo</option>
              <option value="B">B ‚Äî Simplificado</option>
              <option value="C">C ‚Äî MEI/Simples</option>
            </select>
          </div>
          <div class="field">
            <label>Atividade</label>
            <select id="spedAtiv">
              <option value="0">0 ‚Äî Outros</option>
              <option value="1">1 ‚Äî Industrial/Equiparado</option>
              <option value="2">2 ‚Äî Outros (exceto industrial)</option>
            </select>
          </div>
        </div>
        <div id="spedPeriodoMsg"></div>
        <button class="btn-sped-primary" onclick="spedCriarPeriodo()">+ Criar Per√≠odo</button>

        <div class="sped-section-title" style="margin-top:24px">Per√≠odos Cadastrados</div>
        <div id="spedListaPeriodos"><div class="sped-loading">Carregando...</div></div>
      </div>

      <!-- PAINEL: Documentos -->
      <div class="sped-panel hidden" id="spedPanel_documentos">
        <div class="sped-section-title">Adicionar Documento Fiscal</div>
        <div class="sped-form-row">
          <div class="field">
            <label>Tipo *</label>
            <select id="docOper"><option value="0">Entrada</option><option value="1">Sa√≠da</option></select>
          </div>
          <div class="field"><label>N√∫mero NF *</label><input type="text" id="docNum" placeholder="000001"></div>
          <div class="field"><label>S√©rie</label><input type="text" id="docSer" placeholder="001"></div>
          <div class="field"><label>C√≥d. Participante</label><input type="text" id="docPart" placeholder="FORN001"></div>
          <div class="field"><label>Data *</label><input type="date" id="docData"></div>
          <div class="field"><label>Valor Total *</label><input type="number" id="docValor" step="0.01" placeholder="0,00"></div>
          <div class="field"><label>Base C√°lc. ICMS</label><input type="number" id="docBcIcms" step="0.01" placeholder="0,00"></div>
          <div class="field"><label>Valor ICMS</label><input type="number" id="docIcms" step="0.01" placeholder="0,00"></div>
          <div class="field" style="grid-column:span 2"><label>Chave NF-e (44 d√≠gitos)</label><input type="text" id="docChave" placeholder="00000000000000000000000000000000000000000000" maxlength="44"></div>
        </div>
        <div id="spedDocMsg"></div>
        <button class="btn-sped-primary" onclick="spedAdicionarDoc()">+ Adicionar Documento</button>
        <div class="sped-section-title" style="margin-top:20px">Documentos do Per√≠odo</div>
        <div id="spedListaDocs"><div class="sped-msg">Abra um per√≠odo na aba Per√≠odos.</div></div>
      </div>

      <!-- PAINEL: Participantes -->
      <div class="sped-panel hidden" id="spedPanel_participantes">
        <div class="sped-section-title">Adicionar Participante (Fornecedor/Cliente)</div>
        <div class="sped-form-row">
          <div class="field"><label>C√≥digo *</label><input type="text" id="partCod" placeholder="FORN001"></div>
          <div class="field" style="grid-column:span 2"><label>Nome/Raz√£o Social *</label><input type="text" id="partNome" placeholder="Empresa XYZ Ltda"></div>
          <div class="field"><label>CNPJ</label><input type="text" id="partCnpj" placeholder="00.000.000/0000-00"></div>
          <div class="field"><label>Inscri√ß√£o Estadual</label><input type="text" id="partIE" placeholder="000.000.000.000"></div>
          <div class="field"><label>C√≥d. Munic√≠pio (IBGE)</label><input type="text" id="partMun" placeholder="3550308"></div>
        </div>
        <div id="spedPartMsg"></div>
        <button class="btn-sped-primary" onclick="spedAdicionarParticipante()">+ Adicionar Participante</button>
        <div class="sped-section-title" style="margin-top:20px">Participantes Cadastrados</div>
        <div id="spedListaParts"><div class="sped-msg">Abra um per√≠odo primeiro.</div></div>
      </div>

      <!-- PAINEL: Produtos -->
      <div class="sped-panel hidden" id="spedPanel_produtos">
        <div class="sped-section-title">Adicionar Produto/Servi√ßo</div>
        <div class="sped-form-row">
          <div class="field"><label>C√≥digo *</label><input type="text" id="prodCod" placeholder="PROD001"></div>
          <div class="field" style="grid-column:span 2"><label>Descri√ß√£o *</label><input type="text" id="prodDescr" placeholder="Produto X"></div>
          <div class="field"><label>NCM</label><input type="text" id="prodNCM" placeholder="00000000"></div>
          <div class="field"><label>Unidade</label><input type="text" id="prodUnid" placeholder="UN" value="UN"></div>
          <div class="field">
            <label>Tipo</label>
            <select id="prodTipo">
              <option value="00">00 ‚Äî Mercadoria p/ Revenda</option>
              <option value="01">01 ‚Äî Mat√©ria-Prima</option>
              <option value="02">02 ‚Äî Embalagem</option>
              <option value="03">03 ‚Äî Produto em Processo</option>
              <option value="04">04 ‚Äî Produto Acabado</option>
              <option value="05">05 ‚Äî Subproduto</option>
              <option value="06">06 ‚Äî Produto Intermedi√°rio</option>
              <option value="07">07 ‚Äî Material de Uso e Consumo</option>
              <option value="08">08 ‚Äî Ativo Imobilizado</option>
              <option value="09">09 ‚Äî Servi√ßos</option>
              <option value="10">10 ‚Äî Outros Insumos</option>
              <option value="99">99 ‚Äî Outras</option>
            </select>
          </div>
          <div class="field"><label>Al√≠quota ICMS (%)</label><input type="number" id="prodAliq" step="0.01" placeholder="12,00" value="0"></div>
        </div>
        <div id="spedProdMsg"></div>
        <button class="btn-sped-primary" onclick="spedAdicionarProduto()">+ Adicionar Produto</button>
        <div class="sped-section-title" style="margin-top:20px">Produtos Cadastrados</div>
        <div id="spedListaProds"><div class="sped-msg">Abra um per√≠odo primeiro.</div></div>
      </div>

      <!-- PAINEL: Apura√ß√£o ICMS -->
      <div class="sped-panel hidden" id="spedPanel_apuracao">
        <div class="sped-section-title">Apura√ß√£o do ICMS ‚Äî E110</div>
        <p style="font-size:12px;color:var(--text-light);margin-bottom:16px">
          D√©bitos e cr√©ditos s√£o calculados automaticamente dos documentos. Informe ajustes manuais se necess√°rio.
        </p>
        <div id="spedApuracaoResumo"></div>

        <div class="sped-section-title" style="margin-top:20px">Ajustes Manuais</div>
        <div class="sped-form-row">
          <div class="field"><label>Aj. D√©bitos (E111)</label><input type="number" id="apuracao_vl_aj_debitos" step="0.01" value="0"></div>
          <div class="field"><label>Estorno de Cr√©ditos</label><input type="number" id="apuracao_vl_estornos_cred" step="0.01" value="0"></div>
          <div class="field"><label>Aj. Cr√©ditos (E111)</label><input type="number" id="apuracao_vl_aj_creditos" step="0.01" value="0"></div>
          <div class="field"><label>Estorno de D√©bitos</label><input type="number" id="apuracao_vl_estornos_deb" step="0.01" value="0"></div>
          <div class="field"><label>Saldo Credor Anterior</label><input type="number" id="apuracao_vl_sld_credor_ant" step="0.01" value="0"></div>
          <div class="field"><label>Dedu√ß√µes (E116)</label><input type="number" id="apuracao_vl_tot_ded" step="0.01" value="0"></div>
          <div class="field"><label>D√©bitos Especiais</label><input type="number" id="apuracao_deb_esp" step="0.01" value="0"></div>
        </div>
        <button class="btn-sped-primary" onclick="spedRecalcularApuracao()">Recalcular Apura√ß√£o</button>

        <div style="margin-top:24px;padding:14px;background:var(--hover);border-radius:10px;font-size:12px;color:var(--text-light)">
          <strong>Base legal:</strong> Ato COTEPE/ICMS n¬∫ 9/2008 (leiaute EFD-ICMS/IPI) e atualiza√ß√µes.<br>
          O arquivo .txt gerado deve ser importado no PVA (Programa Validador e Assinador) da RFB,
          validado, assinado com certificado digital A1/A3 e transmitido pelo contador respons√°vel.
        </div>
      </div>
    </div>
  </div>


  <div id="overlay" onclick="closeSidebar()"></div>

  <aside id="sidebar">
    <div class="sb-head">
      <div class="sb-title">
        <i data-lucide="history"></i> Conversas
      </div>
      <!-- Seletor de empresa na sidebar -->
      <div class="client-selector" onclick="openClientModal()" title="Trocar empresa">
        <i data-lucide="building-2" style="width:16px;height:16px;flex-shrink:0;color:var(--accent)"></i>
        <span class="client-name" id="sidebarClientName">Selecionar empresa...</span>
        <i data-lucide="chevron-down" style="width:14px;height:14px;flex-shrink:0;color:var(--text-light)"></i>
      </div>
      <button class="btn-new" onclick="newChat()">
        <i data-lucide="plus"></i> Nova Conversa
      </button>
      <div class="sb-search">
        <i data-lucide="search"></i>
        <input type="text" id="searchInput" placeholder="Buscar conversa..." oninput="filterChats()">
      </div>
    </div>
    <div id="hList"></div>
  </aside>

  <main id="chat">
    <div class="c-head">
      <div class="c-left">
        <button class="icon-btn" onclick="toggleSidebar()" title="Conversas">
          <i data-lucide="menu"></i>
        </button>
        <span class="c-title">Chat Fiscal Pro</span>
        <div class="conn" id="conn">
          <i data-lucide="loader" style="width:12px;height:12px;animation:spin 1s linear infinite"></i>
          <span>Conectando...</span>
        </div>
        <!-- Cliente ativo no header -->
        <div class="client-badge desktop-only" id="headerClientBadge" onclick="openClientModal()" title="Trocar empresa" style="display:none;cursor:pointer">
          <i data-lucide="building-2" style="width:12px;height:12px;flex-shrink:0"></i>
          <span id="headerClientName">‚Äî</span>
        </div>

      </div>

      <div class="c-right">
        <!-- Bot√µes sempre vis√≠veis -->
        <button class="icon-btn" onclick="openSped()" title="SPED EFD-ICMS/IPI" id="spedHeaderBtn" data-perm="sped">
          <i data-lucide="file-code-2"></i>
        </button>
        <button class="icon-btn" onclick="openCalculator()" title="Calculadora">
          <i data-lucide="calculator"></i>
        </button>
        <button class="icon-btn" onclick="toggleTheme()" title="Tema">
          <i data-lucide="moon" id="themeIcon"></i>
        </button>

        <!-- Menu "..." ‚Äî s√≥ mobile, agrupa fun√ß√µes secund√°rias -->
        <div class="dropdown-wrap mobile-only">
          <button class="icon-btn" onclick="toggleDropdown('moreMenu')" title="Mais op√ß√µes">
            <i data-lucide="more-vertical"></i>
          </button>
          <div class="hdr-dropdown" id="moreMenu">
            <div class="hdr-dropdown-title">Op√ß√µes</div>
            <button class="menu-item" data-perm="documentos" onclick="openDocumentos(); closeDropdowns()">
              <i data-lucide="file-text"></i> Documentos Fiscais
            </button>
            <button class="menu-item" data-perm="sped" onclick="openSped(); closeDropdowns()">
              <i data-lucide="file-code-2"></i> SPED EFD-ICMS/IPI
            </button>
            <button class="menu-item admin-menu-item" onclick="showStats(); closeDropdowns()">
              <i data-lucide="bar-chart-2"></i> Estat√≠sticas
            </button>
            <button class="menu-item admin-menu-item" onclick="showLearningStats(); closeDropdowns()">
              <i data-lucide="brain"></i> Aprendizado
            </button>
            <button class="menu-item admin-menu-item" onclick="abrirGerenciarPermissoes(); closeDropdowns()">
              <i data-lucide="shield"></i> Permiss√µes de usu√°rios
            </button>
            <button class="menu-item" data-perm="exportar" onclick="exportChat(); closeDropdowns()">
              <i data-lucide="download"></i> Exportar conversa
            </button>
            <button class="menu-item" onclick="shareChat(); closeDropdowns()">
              <i data-lucide="share-2"></i> Compartilhar
            </button>
            <div class="menu-sep"></div>
            <button class="menu-item" onclick="toggleFullscreen(); closeDropdowns()">
              <i data-lucide="maximize-2"></i> Tela cheia
            </button>
            <div class="menu-sep"></div>
            <button class="menu-item" onclick="doLogout()" style="color:var(--error)">
              <i data-lucide="log-out"></i> Sair
            </button>
          </div>
        </div>

        <!-- Bot√µes desktop vis√≠veis individualmente -->
        <button class="icon-btn desktop-only" onclick="openDocumentos()" title="Documentos Fiscais">
          <i data-lucide="file-text"></i>
        </button>
        <button class="icon-btn desktop-only" onclick="exportChat()" title="Exportar">
          <i data-lucide="download"></i>
        </button>
        <button class="icon-btn desktop-only admin-only" onclick="showStats()" title="Estat√≠sticas">
          <i data-lucide="bar-chart-2"></i>
        </button>
        <button class="icon-btn desktop-only admin-only" onclick="showLearningStats()" title="Aprendizado">
          <i data-lucide="brain"></i>
        </button>
        <button class="icon-btn desktop-only" onclick="toggleFullscreen()" title="Tela cheia">
          <i data-lucide="maximize-2"></i>
        </button>

        <!-- Usu√°rio logado + logout -->
        <div class="user-info" onclick="openProfile()" title="Perfil e configura√ß√µes" style="cursor:pointer">
          <span id="headerAvatarWrap"><i data-lucide="user" style="width:14px;height:14px;flex-shrink:0"></i></span>
          <span id="userEmail">‚Äî</span>
        </div>
      </div>
    </div>

    <div id="deadlineAlerts" class="deadline-alerts"></div>

    <div class="tpl">
      <div class="tpl-row">
        <button class="chip" onclick="useTemplate('Como calcular ICMS de R$ 10.000 com al√≠quota 18%?')">
          <i data-lucide="calculator"></i> ICMS
        </button>
        <button class="chip" onclick="useTemplate('Como funciona o ICMS-ST?')">
          <i data-lucide="shield"></i> ICMS-ST
        </button>
        <button class="chip" onclick="useTemplate('Diferen√ßa entre Lucro Real e Presumido')">
          <i data-lucide="bar-chart-2"></i> Regimes
        </button>
        <button class="chip" onclick="useTemplate('Quando usar CFOP 5102?')">
          <i data-lucide="file-text"></i> CFOPs
        </button>
        <button class="chip" onclick="useTemplate('Prazo SPED Fiscal 2024')">
          <i data-lucide="clock"></i> Prazos
        </button>
      </div>
    </div>

    <div id="msgs">
      <div class="empty">
        <i data-lucide="message-circle"></i>
        <h3>Ol√°! Sou seu especialista fiscal</h3>
        <p>Fa√ßa perguntas sobre tributos, CFOPs, c√°lculos e muito mais!</p>
      </div>
    </div>

    <div class="inp-area">
      <div class="inp-row">
        <input type="text" id="msgInput" placeholder="Digite sua d√∫vida fiscal..." maxlength="8000"
          onkeypress="if(event.key==='Enter' && !event.shiftKey) send()"
          oninput="updateCharCount()" autocomplete="off">
        <button class="icon-btn" onclick="document.getElementById('fileInput').click()" title="Anexar arquivos">
          <i data-lucide="paperclip"></i>
        </button>
        <span id="charCount" style="font-size:11px;color:var(--text-light);align-self:center;white-space:nowrap;display:none">0/8000</span>
        <div class="dropdown-wrap" style="position:relative">
          <button class="icon-btn" id="docGenBtn" onclick="toggleDocGenMenu()" title="Gerar documento">
            <i data-lucide="file-down"></i>
          </button>
          <div id="docGenMenu" style="display:none;position:absolute;bottom:44px;right:0;background:var(--card);border:1px solid var(--border);border-radius:10px;box-shadow:0 4px 16px rgba(0,0,0,0.12);min-width:220px;z-index:200;overflow:hidden">
            <div style="padding:8px 12px;font-size:11px;color:var(--text-light);font-weight:600;border-bottom:1px solid var(--border);text-transform:uppercase">Gerar documento</div>
            <button onclick="gerarRelatorioFiscal()" style="display:flex;align-items:center;gap:10px;width:100%;padding:11px 14px;background:none;border:none;cursor:pointer;font-size:13px;color:var(--text);text-align:left" onmouseover="this.style.background='var(--hover)'" onmouseout="this.style.background='none'">
              <i data-lucide="file-text" style="width:15px;height:15px;color:#dc2626"></i> Relat√≥rio Fiscal (PDF)
            </button>
            <button onclick="gerarParecer()" style="display:flex;align-items:center;gap:10px;width:100%;padding:11px 14px;background:none;border:none;cursor:pointer;font-size:13px;color:var(--text);text-align:left" onmouseover="this.style.background='var(--hover)'" onmouseout="this.style.background='none'">
              <i data-lucide="file-type-2" style="width:15px;height:15px;color:#2563eb"></i> Parecer Fiscal (DOCX)
            </button>
            <button onclick="gerarPlanilha()" style="display:flex;align-items:center;gap:10px;width:100%;padding:11px 14px;background:none;border:none;cursor:pointer;font-size:13px;color:var(--text);text-align:left" onmouseover="this.style.background='var(--hover)'" onmouseout="this.style.background='none'">
              <i data-lucide="table-2" style="width:15px;height:15px;color:#16a34a"></i> Planilha de Apura√ß√£o (Excel)
            </button>
          </div>
        </div>
        <button class="btn-send" id="sendBtn" onclick="send()">
          <i data-lucide="send"></i>
        </button>
      </div>
      <div class="file-info" id="fileContainer" style="display: none; padding: 10px 0;">
        <div class="multiple-files" id="multipleFiles"></div>
        <div id="fileProgressContainer" style="display: none;">
          <div class="progress-bar">
            <div id="progressFill" class="progress-fill" style="width: 0%;"></div>
          </div>
        </div>
      </div>
      <input type="file" id="fileInput" style="display: none;" multiple
        accept=".txt,.pdf,.doc,.docx,.xls,.xlsx,.csv,.jpg,.jpeg,.png" onchange="handleMultipleFiles(event)">
      <p class="disclaimer">
        <i data-lucide="alert-triangle" style="width:12px;height:12px;vertical-align:middle;margin-right:4px"></i> As respostas s√£o geradas por intelig√™ncia artificial e podem conter erros. 
        Sempre valide as informa√ß√µes com um contador respons√°vel antes de tomar decis√µes fiscais.
      </p>
    </div>
  </main>

  <!-- MODAL DOCUMENTOS FISCAIS -->
  <div id="docModal">
    <div class="m-box">
      <div class="m-head">
        <span class="m-title"><i data-lucide="file-text" style="width:15px;height:15px;vertical-align:middle;margin-right:6px"></i>Documentos Fiscais</span>
        <button class="btn-close" onclick="closeDocumentos()"><i data-lucide="x"></i></button>
      </div>

      <!-- ABAS -->
      <div class="doc-tabs">
        <button class="doc-tab active" onclick="switchDocTab('nfe', this)">
          <i data-lucide="scan-line" style="width:13px;height:13px;vertical-align:middle;margin-right:4px"></i>Confer√™ncia NF-e
        </button>
        <button class="doc-tab" onclick="switchDocTab('darf', this)">
          <i data-lucide="receipt" style="width:13px;height:13px;vertical-align:middle;margin-right:4px"></i>DARF / DAS
        </button>
      </div>

      <!-- PAINEL NF-e -->
      <div id="docPanelNfe" class="doc-panel active">
        <p style="font-size:13px;color:var(--text-light);margin-bottom:12px">
          Envie um ou mais XMLs de NF-e para confer√™ncia autom√°tica de CFOP, CST, bases e tributos.
        </p>
        <input type="file" id="nfeFileInput" multiple accept=".xml" style="display:none" onchange="processarNFes(event)">
        <button class="doc-btn doc-btn-primary" style="width:100%;margin-bottom:8px" onclick="document.getElementById('nfeFileInput').click()">
          <i data-lucide="upload" style="width:14px;height:14px"></i> Selecionar XMLs de NF-e
        </button>
        <div id="nfeStatus" style="font-size:12px;color:var(--text-light);text-align:center;min-height:20px"></div>
        <div id="nfeResult" class="nfe-result"></div>
        <div class="doc-actions" id="nfeActions" style="display:none">
          <button class="doc-btn doc-btn-secondary" onclick="exportarNFePDF()">
            <i data-lucide="file" style="width:13px;height:13px"></i> PDF
          </button>
          <button class="doc-btn doc-btn-secondary" onclick="exportarNFeExcel()">
            <i data-lucide="table" style="width:13px;height:13px"></i> Excel
          </button>
          <button class="doc-btn doc-btn-primary" onclick="enviarNFeParaChat()">
            <i data-lucide="message-circle" style="width:13px;height:13px"></i> Analisar no Chat
          </button>
        </div>
      </div>

      <!-- PAINEL DARF / DAS -->
      <div id="docPanelDarf" class="doc-panel">
        <div class="darf-form">
          <div class="darf-row">
            <div class="darf-field">
              <label>Regime Tribut√°rio</label>
              <select id="darfRegime" onchange="atualizarCamposDarf()">
                <option value="">Selecione...</option>
                <option value="simples">Simples Nacional</option>
                <option value="mei">MEI</option>
                <option value="presumido">Lucro Presumido</option>
                <option value="real">Lucro Real</option>
              </select>
            </div>
            <div class="darf-field">
              <label>Compet√™ncia (MM/AAAA)</label>
              <input type="text" id="darfCompetencia" placeholder="01/2026" oninput="maskCompetencia(this)">
            </div>
          </div>
          <div class="darf-row">
            <div class="darf-field">
              <label>Faturamento do per√≠odo (R$)</label>
              <input type="number" id="darfFaturamento" placeholder="0,00" min="0" step="0.01" oninput="calcularDarf()">
            </div>
            <div class="darf-field" id="darfFieldLucro" style="display:none">
              <label>Lucro apurado (R$)</label>
              <input type="number" id="darfLucro" placeholder="0,00" min="0" step="0.01" oninput="calcularDarf()">
            </div>
          </div>
          <div class="darf-row" id="darfFieldPro" style="display:none">
            <div class="darf-field">
              <label>Pr√≥-labore total (R$)</label>
              <input type="number" id="darfProlabore" placeholder="0,00" min="0" step="0.01" oninput="calcularDarf()">
            </div>
            <div class="darf-field">
              <label>Folha de pagamento (R$)</label>
              <input type="number" id="darfFolha" placeholder="0,00" min="0" step="0.01" oninput="calcularDarf()">
            </div>
          </div>
          <div class="darf-row">
            <div class="darf-field">
              <label>Data de vencimento</label>
              <input type="date" id="darfVencimento">
            </div>
            <div class="darf-field">
              <label>Data de pagamento (se em atraso)</label>
              <input type="date" id="darfPagamento" oninput="calcularDarf()">
            </div>
          </div>
        </div>

        <div id="darfResult" class="darf-result"></div>

        <div class="doc-actions" id="darfActions" style="display:none">
          <button class="doc-btn doc-btn-secondary" onclick="exportarDarfPDF()">
            <i data-lucide="file" style="width:13px;height:13px"></i> PDF
          </button>
          <button class="doc-btn doc-btn-secondary" onclick="exportarDarfExcel()">
            <i data-lucide="table" style="width:13px;height:13px"></i> Excel
          </button>
          <button class="doc-btn doc-btn-primary" onclick="enviarDarfParaChat()">
            <i data-lucide="message-circle" style="width:13px;height:13px"></i> Analisar no Chat
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL PERFIL -->
  <div id="profileModal" style="display:none;position:fixed;inset:0;z-index:8000;background:rgba(0,0,0,0.5);backdrop-filter:blur(4px);align-items:center;justify-content:center;padding:16px;box-sizing:border-box;" onclick="if(event.target===this)closeProfile()">
    <div style="background:var(--bg);border-radius:16px;width:100%;max-width:480px;max-height:90vh;display:flex;flex-direction:column;box-shadow:0 24px 64px rgba(0,0,0,0.2);overflow:hidden;position:relative;">

      <!-- HEADER FIXO -->
      <div style="padding:20px 24px 0;flex-shrink:0;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
          <h2 style="font-size:17px;font-weight:700;color:var(--text);margin:0">Minha Conta</h2>
          <button onclick="closeProfile()" style="background:var(--sidebar-hover);border:none;cursor:pointer;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--text-light)">
            <i data-lucide="x" style="width:16px;height:16px"></i>
          </button>
        </div>

        <!-- AVATAR + NOME -->
        <div style="display:flex;align-items:center;gap:14px;padding:16px;background:var(--sidebar-hover);border-radius:12px;margin-bottom:16px;">
          <div id="profileAvatar" onclick="document.getElementById('avatarInput').click()" title="Trocar foto" style="width:56px;height:56px;border-radius:50%;background:var(--primary);color:#fff;font-size:22px;font-weight:700;display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;overflow:hidden;border:2px solid var(--primary)">?</div>
          <div style="flex:1;min-width:0;">
            <div id="profileNomeDisplay" style="font-weight:600;font-size:15px;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">‚Äî</div>
            <div id="profileEmailDisplay" style="font-size:12px;color:var(--text-light);margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">‚Äî</div>
          </div>
          <button onclick="doLogout()" style="background:none;border:1px solid var(--border);border-radius:8px;padding:6px 12px;font-size:12px;color:var(--text-light);cursor:pointer;white-space:nowrap;display:flex;align-items:center;gap:6px;flex-shrink:0;">
            <i data-lucide="log-out" style="width:13px;height:13px"></i> Sair
          </button>
        </div>
        <input type="file" id="avatarInput" accept="image/*" style="display:none" onchange="uploadAvatar(this)">

        <!-- ABAS -->
        <div style="display:flex;gap:4px;border-bottom:1px solid var(--border);margin-bottom:0;">
          <button class="doc-tab active" onclick="switchProfileTab('conta',this)" style="font-size:13px;padding:8px 14px;">Conta</button>
          <button class="doc-tab" onclick="switchProfileTab('notif',this)" style="font-size:13px;padding:8px 14px;">Notifica√ß√µes</button>
        </div>
      </div>

      <!-- CONTE√öDO COM SCROLL -->
      <div style="overflow-y:auto;flex:1;padding:20px 24px 24px;-webkit-overflow-scrolling:touch;">

        <!-- ABA CONTA -->
        <div id="profileTabConta" class="doc-panel" style="display:block;">

          <!-- Se√ß√£o: Dados pessoais -->
          <div style="margin-bottom:20px;">
            <h4 style="font-size:12px;font-weight:600;color:var(--text-light);text-transform:uppercase;letter-spacing:.6px;margin:0 0 12px;">Dados pessoais</h4>
            <div style="display:flex;flex-direction:column;gap:10px;">
              <div>
                <label style="font-size:12px;color:var(--text-light);display:block;margin-bottom:4px;">Nome completo</label>
                <input type="text" id="profileNome" placeholder="Seu nome" style="width:100%;box-sizing:border-box;">
              </div>
              <div>
                <label style="font-size:12px;color:var(--text-light);display:block;margin-bottom:4px;">CRC</label>
                <input type="text" id="profileCRC" placeholder="Ex: SP-123456/O-1" style="width:100%;box-sizing:border-box;">
              </div>
              <div id="profileNomeMsg" class="auth-msg"></div>
              <button onclick="salvarNome()" class="btn-sa" style="align-self:flex-end;padding:8px 20px;font-size:13px;">Salvar dados</button>
            </div>
          </div>

          <div style="height:1px;background:var(--border);margin-bottom:20px;"></div>

          <!-- Se√ß√£o: Apar√™ncia -->
          <div style="margin-bottom:20px;">
            <h4 style="font-size:12px;font-weight:600;color:var(--text-light);text-transform:uppercase;letter-spacing:.6px;margin:0 0 12px;">Apar√™ncia</h4>
            <div style="display:flex;align-items:center;justify-content:space-between;padding:12px;background:var(--sidebar-hover);border-radius:10px;">
              <div>
                <div style="font-size:13px;font-weight:500;color:var(--text)">Modo escuro</div>
                <div style="font-size:11px;color:var(--text-light);margin-top:2px">Altera o tema visual do sistema</div>
              </div>
              <label style="position:relative;display:inline-block;width:44px;height:24px;flex-shrink:0;">
                <input type="checkbox" id="profileThemeToggle" onchange="toggleThemeFromProfile(this.checked)" style="opacity:0;width:0;height:0;position:absolute">
                <span style="position:absolute;inset:0;background:var(--border);border-radius:24px;cursor:pointer;transition:.2s;"></span>
                <span style="position:absolute;top:2px;left:2px;width:20px;height:20px;background:#fff;border-radius:50%;transition:.2s;box-shadow:0 1px 4px rgba(0,0,0,.2);"></span>
              </label>
            </div>
          </div>

          <div style="height:1px;background:var(--border);margin-bottom:20px;"></div>

          <!-- Se√ß√£o: Alterar senha -->
          <div>
            <h4 style="font-size:12px;font-weight:600;color:var(--text-light);text-transform:uppercase;letter-spacing:.6px;margin:0 0 12px;">Seguran√ßa</h4>
            <div style="display:flex;flex-direction:column;gap:10px;">
              <div>
                <label style="font-size:12px;color:var(--text-light);display:block;margin-bottom:4px;">Nova senha</label>
                <input type="password" id="profileNewPwd" placeholder="M√≠nimo 8 caracteres" style="width:100%;box-sizing:border-box;" oninput="checkPasswordStrengthEl(this.value,'pwdBar2','pwdHint2')">
                <div id="pwdBar2" style="height:3px;border-radius:2px;margin-top:6px;background:var(--border);transition:all .3s"></div>
                <div id="pwdHint2" style="font-size:11px;color:var(--text-light);margin-top:4px"></div>
              </div>
              <div>
                <label style="font-size:12px;color:var(--text-light);display:block;margin-bottom:4px;">Confirmar nova senha</label>
                <input type="password" id="profileConfirmPwd" placeholder="Repita a senha" style="width:100%;box-sizing:border-box;">
              </div>
              <div id="profilePwdMsg" class="auth-msg"></div>
              <button onclick="salvarSenha()" class="btn-sa" style="align-self:flex-end;padding:8px 20px;font-size:13px;">Alterar senha</button>
            </div>
          </div>
        </div>

        <!-- ABA NOTIFICA√á√ïES -->
        <div id="profileTabNotif" class="doc-panel" style="display:none;">
          <p style="font-size:13px;color:var(--text-light);margin:0 0 20px;line-height:1.5">
            Receba alertas por e-mail sobre prazos fiscais das suas empresas com a anteced√™ncia que preferir.
          </p>

          <div style="display:flex;flex-direction:column;gap:14px;">
            <div>
              <label style="font-size:12px;color:var(--text-light);display:block;margin-bottom:4px;">E-mail para notifica√ß√µes</label>
              <input type="email" id="profileNotifEmail" placeholder="seu@email.com" style="width:100%;box-sizing:border-box;">
            </div>
            <div>
              <label style="font-size:12px;color:var(--text-light);display:block;margin-bottom:4px;">Anteced√™ncia (dias antes do prazo)</label>
              <select id="profileAntecedencia" style="width:100%;box-sizing:border-box;">
                <option value="1">1 dia</option>
                <option value="3" selected>3 dias</option>
                <option value="5">5 dias</option>
                <option value="7">7 dias</option>
                <option value="15">15 dias</option>
              </select>
            </div>
            <div>
              <label style="font-size:12px;color:var(--text-light);display:block;margin-bottom:8px;">Obriga√ß√µes monitoradas</label>
              <div id="notifObrigacoesList" style="display:flex;flex-direction:column;gap:8px;"></div>
            </div>
            <div id="profileNotifMsg" class="auth-msg"></div>
            <button onclick="salvarConfigNotif()" class="btn-sa" style="align-self:flex-end;padding:8px 20px;font-size:13px;">Salvar notifica√ß√µes</button>
          </div>
        </div>

      </div><!-- fim scroll -->
    </div>
  </div>

  <div id="calcModal">
    <div class="m-box">
      <div class="m-head">
        <span class="m-title">Calculadora Fiscal</span>
        <button class="btn-close" onclick="closeCalculator()"><i data-lucide="x"></i></button>
      </div>
      <p class="f-lbl">Valor Base (R$)</p>
      <input type="number" class="c-inp" id="cV" placeholder="Ex: 10000">
      <p class="f-lbl">Al√≠quota ICMS (%)</p>
      <input type="number" class="c-inp" id="cI" value="18">
      <p class="f-lbl">Al√≠quota PIS (%)</p>
      <input type="number" class="c-inp" id="cP" value="1.65">
      <p class="f-lbl">Al√≠quota COFINS (%)</p>
      <input type="number" class="c-inp" id="cC" value="7.6">
      <button class="btn-calc" onclick="calculateTaxes()">
        <i data-lucide="calculator"></i> Calcular
      </button>
      <div class="c-result" id="cResult" style="display:none">
        <div class="c-row"><span>ICMS:</span><span id="rI">-</span></div>
        <div class="c-row"><span>PIS:</span><span id="rP">-</span></div>
        <div class="c-row"><span>COFINS:</span><span id="rC">-</span></div>
        <div class="c-row"><span>Total:</span><span id="rT">-</span></div>
      </div>
    </div>
  </div>

  <div id="statsModal">
    <div class="m-box">
      <div class="m-head">
        <span class="m-title">Estat√≠sticas do Chat</span>
        <button class="btn-close" onclick="closeStats()"><i data-lucide="x"></i></button>
      </div>
      <div id="statsContent"></div>
    </div>
  </div>

  <div id="learningStatsModal">
    <div class="m-box">
      <div class="m-head">
        <span class="m-title"><i data-lucide="brain" style="width:16px;height:16px;vertical-align:middle;margin-right:6px"></i>Aprendizado Fiscal</span>
        <button class="btn-close" onclick="closeLearningStats()"><i data-lucide="x"></i></button>
      </div>
      <div id="learningStatsContent"></div>
      <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border)">
        <p style="font-size:13px;color:var(--text-light);margin-bottom:10px">
          <strong>Base de Conhecimento</strong> ‚Äî envie documentos fiscais para o sistema aprender (PDFs, planilhas, TXTs)
        </p>
        <input type="file" id="batchFileInput" multiple accept=".pdf,.txt,.csv,.xls,.xlsx" style="display:none" onchange="handleBatchUpload(event)">
        <button class="auth-btn" style="padding:10px;font-size:13px;display:flex;align-items:center;gap:6px;justify-content:center" onclick="document.getElementById('batchFileInput').click()">
          <i data-lucide="folder-open" style="width:14px;height:14px"></i>
          Selecionar arquivos para treinamento
        </button>
        <div id="batchProgress" style="margin-top:10px;font-size:12px;color:var(--text-light)"></div>
      </div>
    </div>
  </div>

  <div id="shareModal">
    <div class="m-box">
      <div class="m-head">
        <span class="m-title">Compartilhar Conversa</span>
        <button class="btn-close" onclick="closeShareModal()"><i data-lucide="x"></i></button>
      </div>
      <p>Link para compartilhar:</p>
      <div class="share-link">
        <input type="text" id="shareLink" readonly>
        <button class="icon-btn" onclick="copyShareLink()">
          <i data-lucide="copy"></i>
        </button>
      </div>
      <p style="margin-top: 15px; font-size: 12px; color: var(--text-light);">
        <i data-lucide="alert-triangle" style="width:12px;height:12px;vertical-align:middle;margin-right:4px"></i> Link v√°lido apenas neste dispositivo e navegador por 24 horas.
      </p>
    </div>
  </div>

  <div id="ariaAnnouncer" class="sr-only" aria-live="polite"></div>

  <!-- Scripts ‚Äî ordem importa: core ‚Üí ui ‚Üí clients ‚Üí chat ‚Üí fiscal ‚Üí profile ‚Üí documents ‚Üí sped -->
  <script src="assets/js/core.js?v=6"></script>
  <script src="assets/js/ui.js?v=6"></script>
  <script src="assets/js/clients.js?v=6"></script>
  <script src="assets/js/chat.js?v=6"></script>
  <script src="assets/js/fiscal.js?v=6"></script>
  <script src="assets/js/profile.js?v=6"></script>
  <script src="assets/js/documents.js?v=6"></script>
  <script src="assets/js/sped.js?v=6"></script>
</body>
</html>
